pipeline {
  agent any
  environment {
    NGROK_TOKEN='${NGROK_TOKEN}'
    CONNECT_TO_REMOTE_SERVER="${CONNECT_TO_REMOTE_SERVER}"
    PORT="${PORT_5050}"
  }

  stages {
    stage('Delete old image') {
      steps {
        sh '${CONNECT_TO_REMOTE_SERVER} docker rmi ngrok/ngrok:latest'
      }
    }

    stage('Adjust NgRok') {
      steps {
        sh 'echo "convert http to https"'
        sh '${CONNECT_TO_REMOTE_SERVER} \
            docker run -d --network parser_bot_network -e NGROK_AUTHTOKEN=${NGROK_TOKEN} --name ngrok_container ngrok/ngrok http 5050'
      }
    }
  }
}
